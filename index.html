<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>نظام فحص لوحات المركبات</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #2c3e50;
            --secondary: #3498db;
            --success: #27ae60;
            --danger: #e74c3c;
            --warning: #f39c12;
            --light: #ecf0f1;
            --dark: #2c3e50;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
            padding: 20px;
            transition: all 0.3s ease;
        }
        
        body.ltr {
            direction: ltr;
            text-align: left;
        }
        
        body.ltr .header-title,
        body.ltr .section-title,
        body.ltr .plate-card,
        body.ltr input,
        body.ltr button {
            text-align: left;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        /* Header */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding: 20px;
            background: white;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        .header-title {
            color: var(--primary);
            font-size: 24px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .header-actions {
            display: flex;
            gap: 15px;
            align-items: center;
        }
        
        .admin-btn, .lang-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s ease;
        }
        
        .admin-btn {
            background: var(--secondary);
            color: white;
        }
        
        .admin-btn:hover {
            background: #2980b9;
            transform: translateY(-2px);
        }
        
        .lang-btn {
            background: var(--light);
            color: var(--dark);
        }
        
        .lang-btn:hover {
            background: #d5dbdb;
        }
        
        /* Main Content */
        .main-content {
            display: grid;
            grid-template-columns: 1fr;
            gap: 30px;
        }
        
        @media (min-width: 992px) {
            .main-content {
                grid-template-columns: 1fr 1fr;
            }
        }
        
        /* User Section */
        .user-section, .admin-section {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        .section-title {
            color: var(--primary);
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--light);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        /* Plate Input */
        .plate-input-container {
            margin-bottom: 25px;
        }
        
        .input-label {
            display: block;
            margin-bottom: 8px;
            color: var(--dark);
            font-weight: 600;
        }
        
        .plate-input {
            width: 100%;
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 10px;
            font-size: 18px;
            text-align: center;
            transition: border 0.3s ease;
        }
        
        .plate-input:focus {
            border-color: var(--secondary);
            outline: none;
        }
        
        /* Status Options */
        .status-options {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 25px;
        }
        
        .status-btn {
            padding: 15px;
            border: none;
            border-radius: 10px;
            font-weight: bold;
            font-size: 16px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            transition: all 0.3s ease;
        }
        
        .status-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 10px rgba(0, 0, 0, 0.1);
        }
        
        .status-btn.active {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }
        
        .status-btn.healthy {
            background: #d4edda;
            color: #155724;
            border: 2px solid #c3e6cb;
        }
        
        .status-btn.damaged {
            background: #f8d7da;
            color: #721c24;
            border: 2px solid #f5c6cb;
        }
        
        .status-btn.healthy.active {
            background: var(--success);
            color: white;
        }
        
        .status-btn.damaged.active {
            background: var(--danger);
            color: white;
        }
        
        /* Submit Button */
        .submit-btn {
            width: 100%;
            padding: 16px;
            background: var(--secondary);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            transition: all 0.3s ease;
        }
        
        .submit-btn:hover {
            background: #2980b9;
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(41, 128, 185, 0.4);
        }
        
        .submit-btn:disabled {
            background: #95a5a6;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        /* Result Section */
        .result-container {
            margin-top: 25px;
            padding: 20px;
            border-radius: 10px;
            background: #f8f9fa;
            display: none;
        }
        
        .result-container.show {
            display: block;
            animation: fadeIn 0.5s ease;
        }
        
        .result-title {
            font-size: 18px;
            margin-bottom: 10px;
            color: var(--dark);
        }
        
        .result-status {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 20px;
            font-weight: bold;
            margin-bottom: 10px;
        }
        
        .status-exists {
            color: var(--success);
        }
        
        .status-not-exists {
            color: var(--danger);
        }
        
        .result-details {
            color: #7f8c8d;
            font-size: 14px;
            margin-top: 10px;
        }
        
        /* Admin Login */
        .admin-login {
            background: rgba(0, 0, 0, 0.7);
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        
        .admin-login.show {
            display: flex;
            animation: fadeIn 0.3s ease;
        }
        
        .login-box {
            background: white;
            padding: 30px;
            border-radius: 15px;
            width: 90%;
            max-width: 400px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }
        
        .login-title {
            color: var(--primary);
            margin-bottom: 25px;
            text-align: center;
        }
        
        .login-input {
            width: 100%;
            padding: 12px;
            margin-bottom: 20px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
        }
        
        .login-input:focus {
            border-color: var(--secondary);
            outline: none;
        }
        
        .login-buttons {
            display: flex;
            gap: 10px;
        }
        
        .login-btn, .cancel-btn {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .login-btn {
            background: var(--success);
            color: white;
        }
        
        .login-btn:hover {
            background: #219653;
        }
        
        .cancel-btn {
            background: var(--danger);
            color: white;
        }
        
        .cancel-btn:hover {
            background: #c0392b;
        }
        
        /* Admin Dashboard */
        .admin-dashboard {
            display: none;
        }
        
        .admin-dashboard.show {
            display: block;
        }
        
        /* Stats */
        .stats-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 25px;
        }
        
        .stat-card {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            border-left: 4px solid var(--secondary);
        }
        
        .stat-value {
            font-size: 28px;
            font-weight: bold;
            color: var(--primary);
        }
        
        .stat-label {
            color: #7f8c8d;
            font-size: 14px;
            margin-top: 5px;
        }
        
        /* Admin Actions */
        .admin-actions {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .action-btn {
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s ease;
        }
        
        .upload-btn {
            background: #17a2b8;
            color: white;
        }
        
        .delete-btn {
            background: var(--danger);
            color: white;
        }
        
        .logout-btn {
            background: #6c757d;
            color: white;
        }
        
        /* Plates Table */
        .plates-table-container {
            overflow-x: auto;
            margin-top: 20px;
        }
        
        .plates-table {
            width: 100%;
            border-collapse: collapse;
            min-width: 600px;
        }
        
        .plates-table th {
            background: var(--primary);
            color: white;
            padding: 15px;
            text-align: right;
        }
        
        .plates-table td {
            padding: 12px 15px;
            border-bottom: 1px solid #eee;
        }
        
        .plates-table tr:hover {
            background: #f5f5f5;
        }
        
        .status-badge {
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
        }
        
        .status-healthy {
            background: #d4edda;
            color: #155724;
        }
        
        .status-damaged {
            background: #f8d7da;
            color: #721c24;
        }
        
        .exists-badge {
            font-size: 18px;
        }
        
        /* File Upload Section */
        .upload-section {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }
        
        .upload-info {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
            color: #495057;
        }
        
        .file-input-container {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        
        .file-input {
            flex: 1;
            padding: 10px;
            border: 2px dashed #ccc;
            border-radius: 5px;
            background: white;
            cursor: pointer;
        }
        
        .file-input:hover {
            border-color: var(--secondary);
        }
        
        /* Instructions */
        .instructions {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            color: #856404;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-size: 14px;
        }
        
        .instructions h4 {
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        /* Footer */
        .footer {
            text-align: center;
            margin-top: 30px;
            color: #7f8c8d;
            font-size: 14px;
            padding: 20px;
        }
        
        /* New Styles for Add to System */
        .add-to-system-section {
            margin-top: 20px;
            padding: 15px;
            background: #e8f4fd;
            border: 1px solid #b6d4fe;
            border-radius: 10px;
            display: none;
        }
        
        .add-to-system-section.show {
            display: block;
            animation: fadeIn 0.5s ease;
        }
        
        .add-to-system-title {
            font-size: 16px;
            margin-bottom: 10px;
            color: #0d6efd;
        }
        
        .add-to-system-buttons {
            display: flex;
            gap: 10px;
        }
        
        .add-btn, .cancel-add-btn {
            flex: 1;
            padding: 10px;
            border: none;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .add-btn {
            background: #0d6efd;
            color: white;
        }
        
        .add-btn:hover {
            background: #0b5ed7;
        }
        
        .cancel-add-btn {
            background: #6c757d;
            color: white;
        }
        
        .cancel-add-btn:hover {
            background: #5c636a;
        }
        
        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        @keyframes slideIn {
            from { transform: translateY(-20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .header {
                flex-direction: column;
                gap: 15px;
            }
            
            .header-actions {
                width: 100%;
                justify-content: center;
            }
            
            .status-options {
                grid-template-columns: 1fr;
            }
            
            .admin-actions {
                flex-direction: column;
            }
            
            .action-btn {
                justify-content: center;
            }
            
            .file-input-container {
                flex-direction: column;
            }
            
            .add-to-system-buttons {
                flex-direction: column;
            }
        }
        
        /* Utility Classes */
        .hidden {
            display: none !important;
        }
        
        .text-center {
            text-align: center;
        }
        
        .mb-3 {
            margin-bottom: 15px;
        }
        
        .mt-3 {
            margin-top: 15px;
        }
        
        .alert {
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 15px;
        }
        
        .alert-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .alert-info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <h1 class="header-title">
                <i class="fas fa-car"></i>
                <span class="title-text">نظام فحص لوحات المركبات</span>
            </h1>
            
            <div class="header-actions">
                <button class="lang-btn" id="langBtn">
                    <i class="fas fa-language"></i>
                    <span class="lang-text">EN</span>
                </button>
                <button class="admin-btn" id="adminBtn">
                    <i class="fas fa-lock"></i>
                    <span class="admin-btn-text">دخول المشرف</span>
                </button>
            </div>
        </header>
        
        <!-- Main Content -->
        <div class="main-content">
            <!-- User Section -->
            <section class="user-section">
                <h2 class="section-title">
                    <i class="fas fa-user"></i>
                    <span class="section-title-text">فحص اللوحة</span>
                </h2>
                
                <div class="plate-input-container">
                    <label class="input-label" for="plateInput">أدخل رقم اللوحة</label>
                    <input type="text" id="plateInput" class="plate-input" placeholder="مثال: XTB-3708">
                </div>
                
                <div class="status-options">
                    <button class="status-btn healthy" id="healthyBtn" data-status="healthy">
                        <i class="fas fa-check-circle"></i>
                        <span>سليمة</span>
                    </button>
                    <button class="status-btn damaged" id="damagedBtn" data-status="damaged">
                        <i class="fas fa-times-circle"></i>
                        <span>تالفة</span>
                    </button>
                </div>
                
                <button class="submit-btn" id="submitBtn" disabled>
                    <i class="fas fa-search"></i>
                    <span>فحص اللوحة</span>
                </button>
                
                <!-- Add to System Section -->
                <div class="add-to-system-section" id="addToSystemSection">
                    <h4 class="add-to-system-title" id="addToSystemTitle"></h4>
                    <div class="add-to-system-buttons">
                        <button class="add-btn" id="addBtn">
                            <i class="fas fa-plus-circle"></i>
                            <span id="addBtnText">إضافة للنظام</span>
                        </button>
                        <button class="cancel-add-btn" id="cancelAddBtn">
                            <i class="fas fa-times"></i>
                            <span id="cancelAddBtnText">إلغاء</span>
                        </button>
                    </div>
                </div>
                
                <div class="result-container" id="resultContainer">
                    <h3 class="result-title">نتيجة الفحص:</h3>
                    <div class="result-status" id="resultStatus">
                        <!-- Dynamic content -->
                    </div>
                    <p class="result-details">
                        <i class="fas fa-info-circle"></i>
                        <span>يمكنك فقط رؤية ما إذا كانت اللوحة موجودة في النظام أم لا</span>
                    </p>
                </div>
            </section>
            
            <!-- Admin Section (Initially Hidden) -->
            <section class="admin-section hidden" id="adminSection">
                <h2 class="section-title">
                    <i class="fas fa-tachometer-alt"></i>
                    <span class="section-title-text">لوحة التحكم - المشرف</span>
                </h2>
                
                <div class="admin-dashboard" id="adminDashboard">
                    <!-- Instructions -->
                    <div class="instructions">
                        <h4><i class="fas fa-info-circle"></i> تعليمات الاستخدام</h4>
                        <p>1. قم بتحميل ملف Excel يحتوي على جميع اللوحات المطلوبة</p>
                        <p>2. الملف يجب أن يحتوي على عمود واحد فقط بأرقام اللوحات</p>
                        <p>3. عند فحص أي لوحة، سيتم مقارنتها مع اللوحات الموجودة في الملف</p>
                        <p>4. يمكنك مسح جميع البيانات والبدء من جديد</p>
                    </div>
                    
                    <!-- Stats -->
                    <div class="stats-container">
                        <div class="stat-card">
                            <div class="stat-value" id="totalPlates">0</div>
                            <div class="stat-label">إجمالي اللوحات</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="healthyPlates">0</div>
                            <div class="stat-label">فحوصات سليمة</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="damagedPlates">0</div>
                            <div class="stat-label">فحوصات تالفة</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="todaySubmissions">0</div>
                            <div class="stat-label">فحوصات اليوم</div>
                        </div>
                    </div>
                    
                    <!-- File Upload Section -->
                    <div class="upload-section">
                        <div class="upload-info">
                            <i class="fas fa-file-excel"></i>
                            <span>تحميل ملف Excel باللوحات المطلوبة</span>
                        </div>
                        
                        <div class="file-input-container">
                            <input type="file" id="excelFile" class="file-input" accept=".xlsx, .xls, .csv">
                            <button class="action-btn upload-btn" id="uploadBtn">
                                <i class="fas fa-upload"></i>
                                <span>تحميل الملف</span>
                            </button>
                        </div>
                        
                        <div class="alert alert-info mt-3">
                            <i class="fas fa-lightbulb"></i>
                            <span>ملاحظة: الملف يجب أن يحتوي على أرقام اللوحات في العمود الأول فقط</span>
                        </div>
                    </div>
                    
                    <!-- Admin Actions -->
                    <div class="admin-actions">
                        <button class="action-btn delete-btn" id="deleteAllBtn">
                            <i class="fas fa-trash-alt"></i>
                            <span>مسح جميع البيانات</span>
                        </button>
                        <button class="action-btn logout-btn" id="adminLogoutBtn">
                            <i class="fas fa-sign-out-alt"></i>
                            <span>تسجيل الخروج</span>
                        </button>
                    </div>
                    
                    <!-- Plates Table -->
                    <div class="plates-table-container">
                        <table class="plates-table">
                            <thead>
                                <tr>
                                    <th>رقم اللوحة</th>
                                    <th>الحالة</th>
                                    <th>موجودة في النظام</th>
                                    <th>تاريخ الإضافة</th>
                                </tr>
                            </thead>
                            <tbody id="platesTableBody">
                                <!-- Dynamic rows -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>
        </div>
        
        <!-- Footer -->
        <footer class="footer">
            <p>نظام فحص لوحات المركبات | جاهز 100% للاستخدام</p>
            <p class="mt-3">جميع الحقوق محفوظة &copy; <span id="currentYear"></span></p>
        </footer>
    </div>
    
    <!-- Admin Login Modal -->
    <div class="admin-login" id="adminLogin">
        <div class="login-box">
            <h2 class="login-title">
                <i class="fas fa-lock"></i>
                <span>دخول المشرف</span>
            </h2>
            
            <div class="mb-3">
                <input type="text" id="usernameInput" class="login-input" placeholder="اسم المستخدم">
            </div>
            
            <div class="mb-3">
                <input type="password" id="passwordInput" class="login-input" placeholder="كلمة المرور">
            </div>
            
            <div class="login-buttons">
                <button class="login-btn" id="loginBtn">تسجيل الدخول</button>
                <button class="cancel-btn" id="cancelLoginBtn">إلغاء</button>
            </div>
            
            <p class="text-center mt-3" style="color: #7f8c8d; font-size: 14px;">
                <i class="fas fa-info-circle"></i>
                اسم المستخدم: مهند | كلمة المرور: 123321
            </p>
        </div>
    </div>

    <!-- SheetJS Library for Excel processing -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

    <script>
        // الترجمات
        const translations = {
            ar: {
                title: "نظام فحص لوحات المركبات",
                adminBtn: "دخول المشرف",
                userSectionTitle: "فحص اللوحة",
                plateLabel: "أدخل رقم اللوحة",
                platePlaceholder: "مثال: XTB-3708",
                healthy: "سليمة",
                damaged: "تالفة",
                submit: "فحص اللوحة",
                resultTitle: "نتيجة الفحص:",
                resultDetails: "يمكنك فقط رؤية ما إذا كانت اللوحة موجودة في النظام أم لا",
                adminSectionTitle: "لوحة التحكم - المشرف",
                totalPlates: "إجمالي اللوحات",
                healthyPlates: "فحوصات سليمة",
                damagedPlates: "فحوصات تالفة",
                todaySubmissions: "فحوصات اليوم",
                uploadExcel: "تحميل ملف Excel",
                deleteAll: "مسح جميع البيانات",
                logout: "تسجيل الخروج",
                plateNumber: "رقم اللوحة",
                status: "الحالة",
                existsInSystem: "موجودة في النظام",
                addDate: "تاريخ الإضافة",
                loginTitle: "دخول المشرف",
                usernamePlaceholder: "اسم المستخدم",
                passwordPlaceholder: "كلمة المرور",
                login: "تسجيل الدخول",
                cancel: "إلغاء",
                loginInfo: "اسم المستخدم: مهند | كلمة المرور: 123321",
                footer: "نظام فحص لوحات المركبات | جاهز 100% للاستخدام",
                exists: "موجودة",
                notExists: "غير موجودة",
                checkAgain: "فحص لوحة أخرى",
                submitted: "تم إرسال الفحص بنجاح",
                adminOnly: "المشرف فقط يمكنه رؤية لوحة التحكم",
                error: "حدث خطأ. حاول مرة أخرى.",
                loading: "جاري التحميل...",
                noPlates: "لا توجد لوحات مسجلة بعد",
                uploadSuccess: "تم تحميل الملف بنجاح",
                deleteConfirm: "هل أنت متأكد من مسح جميع البيانات؟",
                deleteSuccess: "تم مسح جميع البيانات بنجاح",
                fileRequired: "يرجى اختيار ملف Excel أولاً",
                fileFormatError: "يرجى اختيار ملف Excel صالح (xlsx, xls, csv)",
                noDataInFile: "الملف لا يحتوي على بيانات",
                fileProcessed: "تم معالجة الملف بنجاح",
                // New translations for add to system
                addToSystemTitle: "اللوحة غير موجودة. هل ترغب في إضافتها للنظام؟",
                addToSystemBtn: "إضافة للنظام",
                cancelAddBtn: "إلغاء",
                addedSuccessfully: "تم إضافة اللوحة للنظام بنجاح",
                alreadyInSystem: "اللوحة موجودة بالفعل في النظام"
            },
            en: {
                title: "Vehicle Plate Checking System",
                adminBtn: "Admin Login",
                userSectionTitle: "Check Plate",
                plateLabel: "Enter plate number",
                platePlaceholder: "Example: XTB-3708",
                healthy: "Healthy",
                damaged: "Damaged",
                submit: "Check Plate",
                resultTitle: "Check Result:",
                resultDetails: "You can only see if the plate exists in the system or not",
                adminSectionTitle: "Control Panel - Admin",
                totalPlates: "Total Plates",
                healthyPlates: "Healthy Checks",
                damagedPlates: "Damaged Checks",
                todaySubmissions: "Today's Checks",
                uploadExcel: "Upload Excel File",
                deleteAll: "Delete All Data",
                logout: "Logout",
                plateNumber: "Plate Number",
                status: "Status",
                existsInSystem: "Exists in System",
                addDate: "Add Date",
                loginTitle: "Admin Login",
                usernamePlaceholder: "Username",
                passwordPlaceholder: "Password",
                login: "Login",
                cancel: "Cancel",
                loginInfo: "Username: mohand | Password: 123321",
                footer: "Vehicle Plate Checking System | 100% Ready",
                exists: "Exists",
                notExists: "Not Exists",
                checkAgain: "Check Another Plate",
                submitted: "Check submitted successfully",
                adminOnly: "Only admin can see the control panel",
                error: "An error occurred. Please try again.",
                loading: "Loading...",
                noPlates: "No plates registered yet",
                uploadSuccess: "File uploaded successfully",
                deleteConfirm: "Are you sure you want to delete all data?",
                deleteSuccess: "All data deleted successfully",
                fileRequired: "Please select an Excel file first",
                fileFormatError: "Please select a valid Excel file (xlsx, xls, csv)",
                noDataInFile: "File does not contain any data",
                fileProcessed: "File processed successfully",
                // New translations for add to system
                addToSystemTitle: "Plate not found. Do you want to add it to the system?",
                addToSystemBtn: "Add to System",
                cancelAddBtn: "Cancel",
                addedSuccessfully: "Plate added to system successfully",
                alreadyInSystem: "Plate already exists in system"
            }
        };

        // حالة التطبيق
        let currentLang = 'ar';
        let currentUser = null;
        let selectedStatus = null;
        let currentPlateCheck = null; // لتخزين معلومات اللوحة الحالية
        
        // تخزين البيانات محلياً
        let plates = []; // اللوحات من ملف Excel
        let submissions = []; // الفحوصات

        // عناصر DOM
        const elements = {
            titleText: document.querySelector('.title-text'),
            adminBtnText: document.querySelector('.admin-btn-text'),
            langBtn: document.getElementById('langBtn'),
            langText: document.querySelector('.lang-text'),
            adminBtn: document.getElementById('adminBtn'),
            sectionTitleText: document.querySelector('.section-title-text'),
            plateLabel: document.querySelector('.input-label'),
            plateInput: document.getElementById('plateInput'),
            healthyBtn: document.getElementById('healthyBtn'),
            damagedBtn: document.getElementById('damagedBtn'),
            submitBtn: document.getElementById('submitBtn'),
            resultContainer: document.getElementById('resultContainer'),
            resultStatus: document.getElementById('resultStatus'),
            resultDetails: document.querySelector('.result-details'),
            adminSection: document.getElementById('adminSection'),
            adminSectionTitle: document.querySelectorAll('.section-title-text')[1],
            totalPlates: document.getElementById('totalPlates'),
            healthyPlates: document.getElementById('healthyPlates'),
            damagedPlates: document.getElementById('damagedPlates'),
            todaySubmissions: document.getElementById('todaySubmissions'),
            excelFile: document.getElementById('excelFile'),
            uploadBtn: document.getElementById('uploadBtn'),
            deleteAllBtn: document.getElementById('deleteAllBtn'),
            adminLogoutBtn: document.getElementById('adminLogoutBtn'),
            platesTableBody: document.getElementById('platesTableBody'),
            adminLogin: document.getElementById('adminLogin'),
            loginTitle: document.querySelector('.login-title span'),
            usernameInput: document.getElementById('usernameInput'),
            passwordInput: document.getElementById('passwordInput'),
            loginBtn: document.getElementById('loginBtn'),
            cancelLoginBtn: document.getElementById('cancelLoginBtn'),
            loginInfo: document.querySelector('.login-box p'),
            footer: document.querySelector('.footer p'),
            currentYear: document.getElementById('currentYear'),
            // New elements
            addToSystemSection: document.getElementById('addToSystemSection'),
            addToSystemTitle: document.getElementById('addToSystemTitle'),
            addBtn: document.getElementById('addBtn'),
            cancelAddBtn: document.getElementById('cancelAddBtn'),
            addBtnText: document.getElementById('addBtnText'),
            cancelAddBtnText: document.getElementById('cancelAddBtnText')
        };

        // تهيئة التطبيق
        function initApp() {
            // تعيين السنة الحالية
            elements.currentYear.textContent = new Date().getFullYear();
            
            // تحميل البيانات المحفوظة
            loadSavedData();
            
            // إعداد معالجات الأحداث
            setupEventListeners();
            
            // تطبيق اللغة الحالية
            applyLanguage();
            
            // إخفاء قسم الإضافة
            elements.addToSystemSection.classList.remove('show');
        }

        // تحميل البيانات المحفوظة
        function loadSavedData() {
            try {
                // تحميل اللوحات
                const savedPlates = localStorage.getItem('plateSystem_plates');
                if (savedPlates) {
                    plates = JSON.parse(savedPlates);
                }
                
                // تحميل الفحوصات
                const savedSubmissions = localStorage.getItem('plateSystem_submissions');
                if (savedSubmissions) {
                    submissions = JSON.parse(savedSubmissions);
                }
            } catch (error) {
                console.log("No saved data found, starting fresh");
                plates = [];
                submissions = [];
            }
        }

        // حفظ البيانات
        function saveData() {
            localStorage.setItem('plateSystem_plates', JSON.stringify(plates));
            localStorage.setItem('plateSystem_submissions', JSON.stringify(submissions));
        }

        // إعداد معالجات الأحداث
        function setupEventListeners() {
            // أزرار الحالة
            elements.healthyBtn.addEventListener('click', () => selectStatus('healthy'));
            elements.damagedBtn.addEventListener('click', () => selectStatus('damaged'));
            
            // زر الفحص
            elements.submitBtn.addEventListener('click', checkPlate);
            
            // حقل الإدخال
            elements.plateInput.addEventListener('input', validateForm);
            elements.plateInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter' && !elements.submitBtn.disabled) {
                    checkPlate();
                }
            });
            
            // زر المشرف
            elements.adminBtn.addEventListener('click', showAdminLogin);
            
            // زر اللغة
            elements.langBtn.addEventListener('click', toggleLanguage);
            
            // تسجيل الدخول
            elements.loginBtn.addEventListener('click', adminLogin);
            elements.cancelLoginBtn.addEventListener('click', hideAdminLogin);
            
            // إدخال كلمة المرور عند الضغط على Enter
            elements.passwordInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') adminLogin();
            });
            
            // زر تحميل الملف
            elements.uploadBtn.addEventListener('click', uploadExcelFile);
            
            // زر مسح البيانات
            elements.deleteAllBtn.addEventListener('click', deleteAllData);
            
            // زر تسجيل الخروج
            elements.adminLogoutBtn.addEventListener('click', adminLogout);
            
            // زر إضافة اللوحة للنظام
            elements.addBtn.addEventListener('click', addPlateToSystem);
            
            // زر إلغاء الإضافة
            elements.cancelAddBtn.addEventListener('click', hideAddToSystemSection);
        }

        // تبديل اللغة
        function toggleLanguage() {
            currentLang = currentLang === 'ar' ? 'en' : 'ar';
            document.body.classList.toggle('ltr', currentLang === 'en');
            applyLanguage();
        }

        // تطبيق اللغة
        function applyLanguage() {
            const t = translations[currentLang];
            
            // Header
            elements.titleText.textContent = t.title;
            elements.adminBtnText.textContent = t.adminBtn;
            elements.langText.textContent = currentLang === 'ar' ? 'EN' : 'عربي';
            
            // User Section
            elements.sectionTitleText.textContent = t.userSectionTitle;
            elements.plateLabel.textContent = t.plateLabel;
            elements.plateInput.placeholder = t.platePlaceholder;
            elements.healthyBtn.querySelector('span').textContent = t.healthy;
            elements.damagedBtn.querySelector('span').textContent = t.damaged;
            elements.submitBtn.querySelector('span').textContent = t.submit;
            
            // Result (if visible)
            if (elements.resultContainer.classList.contains('show')) {
                elements.resultContainer.querySelector('.result-title').textContent = t.resultTitle;
                elements.resultDetails.querySelector('span').textContent = t.resultDetails;
            }
            
            // Add to System Section
            elements.addBtnText.textContent = t.addToSystemBtn;
            elements.cancelAddBtnText.textContent = t.cancelAddBtn;
            
            // Admin Section
            if (currentUser) {
                elements.adminSectionTitle.textContent = t.adminSectionTitle;
                document.querySelectorAll('.stat-label')[0].textContent = t.totalPlates;
                document.querySelectorAll('.stat-label')[1].textContent = t.healthyPlates;
                document.querySelectorAll('.stat-label')[2].textContent = t.damagedPlates;
                document.querySelectorAll('.stat-label')[3].textContent = t.todaySubmissions;
                elements.uploadBtn.querySelector('span').textContent = t.uploadExcel;
                elements.deleteAllBtn.querySelector('span').textContent = t.deleteAll;
                elements.adminLogoutBtn.querySelector('span').textContent = t.logout;
                
                // Update table headers
                const ths = document.querySelectorAll('.plates-table th');
                ths[0].textContent = t.plateNumber;
                ths[1].textContent = t.status;
                ths[2].textContent = t.existsInSystem;
                ths[3].textContent = t.addDate;
            }
            
            // Admin Login
            elements.loginTitle.textContent = t.loginTitle;
            elements.usernameInput.placeholder = t.usernamePlaceholder;
            elements.passwordInput.placeholder = t.passwordPlaceholder;
            elements.loginBtn.textContent = t.login;
            elements.cancelLoginBtn.textContent = t.cancel;
            elements.loginInfo.innerHTML = `<i class="fas fa-info-circle"></i> ${t.loginInfo}`;
            
            // Footer
            elements.footer.textContent = t.footer;
        }

        // تحديد الحالة
        function selectStatus(status) {
            selectedStatus = status;
            
            // تحديث الأزرار
            elements.healthyBtn.classList.toggle('active', status === 'healthy');
            elements.damagedBtn.classList.toggle('active', status === 'damaged');
            
            validateForm();
        }

        // التحقق من النموذج
        function validateForm() {
            const plateNumber = elements.plateInput.value.trim();
            const isValid = plateNumber.length > 0 && selectedStatus !== null;
            
            elements.submitBtn.disabled = !isValid;
        }

        // فحص اللوحة - معدل للبحث بشكل صحيح
        function checkPlate() {
            const plateNumber = elements.plateInput.value.trim().toUpperCase();
            const status = selectedStatus;
            
            if (!plateNumber || !status) return;
            
            // تنظيف رقم اللوحة للبحث
            const cleanedPlate = plateNumber.replace(/\s+/g, '').replace(/-/g, '');
            
            // البحث في اللوحات - البحث بشكل مرن
            let exists = false;
            let foundPlate = null;
            
            for (let plate of plates) {
                // تنظيف رقم اللوحة المخزن
                const cleanedStoredPlate = plate.number.replace(/\s+/g, '').replace(/-/g, '').toUpperCase();
                
                if (cleanedStoredPlate === cleanedPlate) {
                    exists = true;
                    foundPlate = plate;
                    break;
                }
            }
            
            // حفظ معلومات اللوحة الحالية
            currentPlateCheck = {
                plateNumber,
                cleanedPlate,
                status,
                exists,
                foundPlate,
                timestamp: new Date().toISOString(),
                date: new Date().toISOString().split('T')[0]
            };
            
            // حفظ الفحص
            submissions.push(currentPlateCheck);
            saveData();
            
            // عرض النتيجة
            showResult(exists);
            
            // إظهار خيار الإضافة إذا لم تكن موجودة
            if (!exists) {
                showAddToSystemSection();
            } else {
                hideAddToSystemSection();
            }
            
            // تحديث الإحصائيات إذا كان المشرف مسجلاً
            if (currentUser) {
                updateStats();
                updatePlatesTable();
            }
        }

        // عرض النتيجة
        function showResult(exists) {
            const t = translations[currentLang];
            
            let resultHTML = '';
            if (exists) {
                resultHTML = `
                    <i class="fas fa-check-circle status-exists"></i>
                    <span class="status-exists">${t.exists} ✔</span>
                    <p style="margin-top: 10px; color: #27ae60;">
                        <i class="fas fa-check"></i> اللوحة موجودة في النظام
                    </p>
                `;
            } else {
                resultHTML = `
                    <i class="fas fa-times-circle status-not-exists"></i>
                    <span class="status-not-exists">${t.notExists} ✖</span>
                    <p style="margin-top: 10px; color: #e74c3c;">
                        <i class="fas fa-times"></i> اللوحة غير موجودة في النظام
                    </p>
                `;
            }
            
            elements.resultStatus.innerHTML = resultHTML;
            elements.resultContainer.classList.add('show');
            
            // إضافة زر للفحص مرة أخرى
            const checkAgainBtn = document.createElement('button');
            checkAgainBtn.className = 'submit-btn mt-3';
            checkAgainBtn.innerHTML = `<i class="fas fa-redo"></i> <span>${t.checkAgain}</span>`;
            checkAgainBtn.onclick = () => {
                elements.resultContainer.classList.remove('show');
                elements.plateInput.focus();
            };
            
            // إزالة الزر السابق إذا كان موجوداً
            const existingBtn = elements.resultContainer.querySelector('button');
            if (existingBtn) {
                existingBtn.remove();
            }
            
            elements.resultContainer.appendChild(checkAgainBtn);
        }

        // إظهار قسم إضافة اللوحة للنظام
        function showAddToSystemSection() {
            const t = translations[currentLang];
            elements.addToSystemTitle.textContent = t.addToSystemTitle;
            elements.addToSystemSection.classList.add('show');
        }

        // إخفاء قسم إضافة اللوحة للنظام
        function hideAddToSystemSection() {
            elements.addToSystemSection.classList.remove('show');
        }

        // إضافة اللوحة للنظام
        function addPlateToSystem() {
            if (!currentPlateCheck) return;
            
            const t = translations[currentLang];
            
            // التحقق من عدم تكرار اللوحة
            const alreadyExists = plates.some(plate => {
                const cleanedStoredPlate = plate.number.replace(/\s+/g, '').replace(/-/g, '').toUpperCase();
                return cleanedStoredPlate === currentPlateCheck.cleanedPlate;
            });
            
            if (alreadyExists) {
                alert(t.alreadyInSystem);
                hideAddToSystemSection();
                return;
            }
            
            // إضافة اللوحة للنظام
            plates.push({
                number: currentPlateCheck.plateNumber,
                status: currentPlateCheck.status,
                timestamp: new Date().toISOString(),
                addedFromUser: true,
                addedDate: new Date().toISOString().split('T')[0]
            });
            
            // تحديث حالة اللوحة الحالية
            currentPlateCheck.exists = true;
            
            // حفظ البيانات
            saveData();
            
            // تحديث النتيجة
            showResult(true);
            hideAddToSystemSection();
            
            // تحديث الواجهة إذا كان المشرف مسجلاً
            if (currentUser) {
                updatePlatesTable();
                updateStats();
            }
            
            // إظهار رسالة تأكيد
            alert(t.addedSuccessfully);
        }

        // تحميل ملف Excel - معدل لمعالجة الملف بشكل صحيح
        function uploadExcelFile() {
            const file = elements.excelFile.files[0];
            const t = translations[currentLang];
            
            if (!file) {
                alert(t.fileRequired);
                return;
            }
            
            // التحقق من صيغة الملف
            const validExtensions = ['.xlsx', '.xls', '.csv'];
            const fileExtension = '.' + file.name.split('.').pop().toLowerCase();
            
            if (!validExtensions.includes(fileExtension)) {
                alert(t.fileFormatError);
                return;
            }
            
            const reader = new FileReader();
            
            reader.onload = function(e) {
                try {
                    const data = new Uint8Array(e.target.result);
                    const workbook = XLSX.read(data, { type: 'array' });
                    
                    // الحصول على اسم الورقة الأولى
                    const firstSheetName = workbook.SheetNames[0];
                    const worksheet = workbook.Sheets[firstSheetName];
                    
                    // تحويل الورقة إلى JSON
                    const jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1 });
                    
                    if (jsonData.length === 0) {
                        alert(t.noDataInFile);
                        return;
                    }
                    
                    let addedCount = 0;
                    
                    // معالجة البيانات
                    jsonData.forEach((row, index) => {
                        // تجاهل الصف الفارغ
                        if (!row || row.length === 0) return;
                        
                        // أخذ أول عمود فقط
                        if (row[0]) {
                            let plateNumber = String(row[0]).trim().toUpperCase();
                            
                            if (plateNumber && plateNumber.length >= 2) {
                                // تنظيف رقم اللوحة
                                const cleanedPlate = plateNumber.replace(/\s+/g, '').replace(/-/g, '');
                                
                                // التحقق من عدم تكرار اللوحة
                                const isDuplicate = plates.some(plate => {
                                    const cleanedStoredPlate = plate.number.replace(/\s+/g, '').replace(/-/g, '').toUpperCase();
                                    return cleanedStoredPlate === cleanedPlate;
                                });
                                
                                if (!isDuplicate) {
                                    plates.push({
                                        number: plateNumber,
                                        timestamp: new Date().toISOString(),
                                        addedFromExcel: true
                                    });
                                    addedCount++;
                                }
                            }
                        }
                    });
                    
                    // حفظ البيانات
                    saveData();
                    
                    // تحديث الواجهة
                    if (currentUser) {
                        updatePlatesTable();
                        updateStats();
                    }
                    
                    // إعادة تعيين حقل الملف
                    elements.excelFile.value = '';
                    
                    alert(`${t.fileProcessed} - ${addedCount} ${currentLang === 'ar' ? 'لوحة مضافة' : 'plates added'}`);
                    
                } catch (error) {
                    console.error("Error processing file:", error);
                    alert(t.error);
                }
            };
            
            reader.onerror = function() {
                alert(t.error);
            };
            
            reader.readAsArrayBuffer(file);
        }

        // مسح جميع البيانات
        function deleteAllData() {
            const t = translations[currentLang];
            
            if (!confirm(t.deleteConfirm)) {
                return;
            }
            
            // مسح البيانات
            plates = [];
            submissions = [];
            
            // مسح التخزين المحلي
            localStorage.removeItem('plateSystem_plates');
            localStorage.removeItem('plateSystem_submissions');
            
            // تحديث الواجهة
            if (currentUser) {
                updatePlatesTable();
                updateStats();
            }
            
            alert(t.deleteSuccess);
        }

        // تحديث جدول اللوحات
        function updatePlatesTable() {
            const t = translations[currentLang];
            
            if (plates.length === 0) {
                elements.platesTableBody.innerHTML = `
                    <tr>
                        <td colspan="4" class="text-center">${t.noPlates}</td>
                    </tr>
                `;
                return;
            }
            
            let tableHTML = '';
            plates.forEach((plate, index) => {
                const date = plate.timestamp ? new Date(plate.timestamp).toLocaleDateString(currentLang === 'ar' ? 'ar-SA' : 'en-US') : 'N/A';
                
                tableHTML += `
                    <tr>
                        <td>${plate.number}</td>
                        <td>
                            <span class="status-badge ${plate.status === 'damaged' ? 'status-damaged' : 'status-healthy'}">
                                ${plate.status === 'damaged' ? t.damaged : t.healthy}
                            </span>
                        </td>
                        <td class="exists-badge">
                            ✔
                        </td>
                        <td>${date}</td>
                    </tr>
                `;
                
                // عرض 50 لوحة فقط للسرعة
                if (index >= 50) {
                    return;
                }
            });
            
            if (plates.length > 50) {
                tableHTML += `
                    <tr>
                        <td colspan="4" class="text-center">
                            ${currentLang === 'ar' ? '... وعرض ' : '... and '} ${plates.length - 50} ${currentLang === 'ar' ? 'لوحة أخرى' : 'more plates'}
                        </td>
                    </tr>
                `;
            }
            
            elements.platesTableBody.innerHTML = tableHTML;
        }

        // تحديث الإحصائيات
        function updateStats() {
            // إجمالي اللوحات
            elements.totalPlates.textContent = plates.length;
            
            // الفحوصات السليمة
            const healthyCount = submissions.filter(sub => sub.status === 'healthy').length;
            elements.healthyPlates.textContent = healthyCount;
            
            // الفحوصات التالفة
            const damagedCount = submissions.filter(sub => sub.status === 'damaged').length;
            elements.damagedPlates.textContent = damagedCount;
            
            // فحوصات اليوم
            const today = new Date().toISOString().split('T')[0];
            const todayCount = submissions.filter(sub => sub.date === today).length;
            elements.todaySubmissions.textContent = todayCount;
        }

        // عرض تسجيل دخول المشرف
        function showAdminLogin() {
            elements.adminLogin.classList.add('show');
            elements.usernameInput.focus();
        }

        // إخفاء تسجيل دخول المشرف
        function hideAdminLogin() {
            elements.adminLogin.classList.remove('show');
            elements.usernameInput.value = '';
            elements.passwordInput.value = '';
        }

        // تسجيل دخول المشرف
        function adminLogin() {
            const username = elements.usernameInput.value.trim();
            const password = elements.passwordInput.value;
            
            if ((username === 'مهند' || username === 'mohand') && password === '123321') {
                currentUser = { username: 'مهند' };
                
                // إخفاء نافذة التسجيل
                hideAdminLogin();
                
                // عرض قسم المشرف
                elements.adminSection.classList.remove('hidden');
                document.querySelector('.admin-dashboard').classList.add('show');
                
                // تحديث البيانات
                updatePlatesTable();
                updateStats();
                
                // إخفاء زر المشرف
                elements.adminBtn.style.display = 'none';
                
                // رسالة تأكيد
                alert(translations[currentLang].adminOnly);
            } else {
                alert('اسم المستخدم أو كلمة المرور غير صحيحة');
            }
        }

        // تسجيل خروج المشرف
        function adminLogout() {
            currentUser = null;
            
            // إخفاء قسم المشرف
            elements.adminSection.classList.add('hidden');
            document.querySelector('.admin-dashboard').classList.remove('show');
            
            // إظهار زر المشرف
            elements.adminBtn.style.display = 'flex';
        }

        // بدء تشغيل التطبيق
        document.addEventListener('DOMContentLoaded', initApp);
    </script>
</body>
</html>
